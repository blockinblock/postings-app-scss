<div class="container">
  <app-header></app-header>
  <app-loading-spinner *ngIf="isFetching && !error"></app-loading-spinner>
  <app-error *ngIf="error" [error]="error"></app-error>
  <form [formGroup]="searchForm">
    <div>
      <label for="country">Select country</label>
      <select
        id="country"
        formControlName="country">
        <option *ngFor="let country of countries" [value]="country" >{{ country }}</option>
      </select>
    </div>
    <div>
      <label for="country">Select department</label>
      <select
        id="department"
        formControlName="department">
        <option *ngFor="let department of departments" [value]="department" >{{ department }}</option>
      </select>
    </div>
    <button (click)="onReset()">Reset</button>
  </form>
  <ng-template #noResults>
    <app-results [results]="0"></app-results>
  </ng-template>
  <div *ngIf="listings; else noResults">
    <div *ngIf="(listings
      | filter:filteredCountry:'country':unfiltered
      | filter:filteredDepartment:'department':unfiltered) as results">
      <app-results [results]="results.length"></app-results>
      <ul>
        <li
          *ngFor="let listing of results; index as i; count as totResults">
          <div [routerLink]="[ '/details', listing.id ]">
            <span>
              <h6>{{ listing.name }} ({{ listing.id }})</h6>
              {{ listing.city }},  {{ listing.country }}
            </span>
          </div>
        </li>
      </ul>
    </div>
  </div>
</div>
